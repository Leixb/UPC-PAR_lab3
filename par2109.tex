% vim: spell spelllang=en:
\input{preamble}

\usepackage{caption}
\usepackage{subcaption}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{lipsum}

\usepackage{siunitx}
\usepackage{hyphenat}

\usepackage{xcolor}

\definecolor{LightGray}{rgb}{0.83, 0.83, 0.83}
\definecolor{bg}{HTML}{282828}

\usepackage{minted}
\setminted{
style=monokai,
%frame=lines,
framesep=2mm,
baselinestretch=1.2,
breaklines,
bgcolor=bg,
fontsize=\footnotesize,
linenos
}

\renewcommand\theadfont{\bfseries}

\title{
    PAR Laboratory Assignment\\
    Lab 3: Embarrassingly parallelism with OpenMP: Mandelbrot set
}

\author{
    par2109:
    Aleix Boné,
    Alex Herrero
}

\date{
    Spring 2019-20
}

\begin{document}

\thispagestyle{empty}
\clearpage
\setcounter{page}{-1}

\begin{titlepage}
{
    \centering
    \null
    \vfill
    {\Huge \bfseries PAR Laboratory Assignment\par}
    \vspace{3em}
    {\Large {\scshape Lab 3:} Embarrassingly parallelism with OpenMP: Mandelbrot set \par}
    \vfill
\begin{center}
\end{center}
    \vspace{3cm}

    \vfill
    {\raggedleft \Large
        Aleix Boné\\
        Alex Herrero\\
        {\bfseries\ttfamily par2109}\\
        \vspace{4em}
        2020-04-16
        \par}
}
\end{titlepage}


\section{Introduction}%
\label{sec:Introduction}

% copy paste form here to ... 
% (solo he cambbiado el tiempo verbal, no se si hace falta cambiarlo más ya que enrealidad lo que queremos decir al principio es lo mismo que dice el enunciado...) (y bueno he borrado un par de parrafos)
In this laboratory assignment we explored the tasking model in OpenMP to express iterative task decompositions. 
We started by exploring the most appropriate ones by using \emph{Tareador}. The program that we used is the computation of the \emph{Mandelbrot set}, a particular set of points, in the complex domain, whose boundary generates a distinctive and easily recognisable two-dimensional fractal shape.

For each point $c$ in a delimited two-dimensional space, the complex quadratic polynomial recurrence $z_{n+1} = z^2_n + c$ is iteratively applied in order to determine if it belongs or not to the Mandelbrot set.  The point is part of the Mandelbrot set if, when starting with $z_0 = 0$ and applying the iteration repeatedly, the absolute value of $z_n$ never exceeds a certain number however large $n$ gets.

We analyzed the potential parallelism for two possible task granularities that can be exploited in this program. Those two are:
\begin{enumerate}[label=\alph*)]
\item \emph{Point}: a task corresponds with the computation of a single point (\texttt{row},\texttt{col}) of the Mandelbrot set.
\item \emph{Row}: a task corresponds with the computation of a whole \texttt{row} of the Mandelbrot set.
\end{enumerate}
% ... here

We executed both, \texttt{mandel-tar}\footnote{\texttt{mandel}: used for timing purposes and to check for the numerical validity of the output.} and \texttt{mandeld-tar}\footnote{\texttt{mandeld}: generates a binary that visualizes the Mandelbrot set.}, programs with the different granularities using the \texttt{./run-tareador.sh} script and we obtained the following dependency graphs.

\begin{figure}[H]
\centering
\includegraphics[width=0.6\textwidth]{plots/dependency_graph_mandel_point.pdf}
\caption{Task dependence graph of \texttt{mandel-tar.c} with point decomposition.}
\label{graph:mandel_point}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.7\textwidth]{plots/dependency_graph_mandel_row.pdf}
\caption{Task dependence graph of \texttt{mandel-tar.c} with row decomposition.}
\label{graph:mandel_row}
\end{figure}

%damn los tamaños jajajaja
% estos graphs son una mierda porque son verticales...
% RIP
% como se puede poner uno al lado del otro?
% te importa que sean la misma figure?
% no me importa ya me apaño luego al comentar
% pues metes los dos include graphics en la misma figure
% pero asegurandote de k la width no es muy grande en plan los dos a menos de 0.5 pork sino no caben
\begin{figure}[H]
\centering
\includegraphics[height=5cm]{plots/dependency_graph_mandeld_point.pdf}
%no puede hacerlo pork el pdf es demasiado grande lol
%los convierto a png
%gimme a sec
% ok
% i sin caption
% \caption{Task dependence graph of \texttt{mandeld-tar.c} with point decomposition.}
% \label{graph:mandeld_point}
% LOL usa height
% rip
\includegraphics[width=0.3\textwidth]{plots/dependency_graph_mandeld_row.pdf}
\caption{Task dependence graph of \texttt{mandeld-tar.c} with row decomposition.}
\label{graph:mandeld_row}
\end{figure}

As we can see in figures~\ref{graph:mandel_point} and~\ref{graph:mandel_row} there is a big granularity difference between both decompositions in the \texttt{mandel} version.

% Which are the two most important common characteristics of the task graphs generated for the two task granularities (Point and Row) for the non-graphical version of mandel-tar?  Why the task graphs generated for mandel-tar and mandeld-tar are so different?  Which section of the code do you think is causing the serialization of all tasks in the graphical version?  How will you protect this section of code in the parallel OpenMP code in the next sections?

% Reason which one of the two task granularities would be more appropriate to apply to implement a parallel version of the Mandelbrot code.

\section{Parallelization Strategies}%
\label{sec:Parallelization Strategies}

%aqui explicas las strategias del 4.2, 4.3 y 4.4

%$ OMP_NUM_THREADS=1 ./mandeld-omp -i 10000
%Total execution time: 3.228077s
%$ ./mandeld -i 10000
%Total execution time: 3.061886s
%$ OMP_NUM_THREADS=8 ./mandeld-omp -i 10000
%Total execution time: 1.210712s

\section{Performance evaluation}%
\label{sec:Performance evaluation}

%Aqui comparas

\begin{table}[H]
    \caption{Execution times with different grainsizes}%
    \label{tab:grainsize}
    \begin{center}
    \input{tables/grainsizes}
    \end{center}
\end{table}

\begin{figure}[H]
    \centering
    \includegraphics{plots/grainsize.pdf}
    \caption{Plot of execution time for different grainsizes}
    \label{fig:grain} 
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics{plots/grainsize_log.pdf}
    \caption{Plot of execution time for different grainsizes (log scale)}
    \label{fig:grain_log} 
\end{figure}

\begin{figure}[H]
    \centering
    \caption{Mandel tar code}
    \inputminted[firstline=91,lastline=127]{c}{sources/mandel-tar.c}
    \vspace{-2em}
    \inputminted[firstline=200,lastline=210]{c}{sources/mandel-tar.c}
    \label{fig:grain_log} 
\end{figure}

\section{Conclusions}%
\label{sec:Conclusions}

%I aqui pues relleno bonito del final


\end{document}
